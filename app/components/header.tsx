"use client"

import Link from 'next/link'
import { useUser } from '../providers/UserProvider'
import { useLanguage } from '../providers/LanguageProvider'
import { useTheme } from '../providers/ThemeProvider'
import { User, Layers, LifeBuoy, Settings, Trophy, BookOpen } from 'lucide-react'
import LanguageSwitcher from './LanguageSwitcher'
// Inlined Flotter wordmark SVG (rounded-square) per request

export default function Header() {
  const { user, isLoading } = useUser()
  const { t } = useLanguage()
  const { isDark } = useTheme()

  return (
    // Applied: primary background (#121212) and divider color (#262626)
    // Height: Not explicitly in JSON for header, but set to 64px to match Nav Bar consistency
    <header className={`fixed top-0 left-0 right-0 z-[100] h-[64px] border-b backdrop-blur-xl ${isDark ? 'border-[#262626] bg-[#1c1c1e]/90' : 'border-[#E2E4E9] bg-white/90'}`}>
      <nav className="max-w-5xl mx-auto px-[6px] h-full flex items-center justify-between">

        {/* Left: Brand Logo */}
        <div className="flex items-center">
          <Link href={user ? '/cards/learning' : '/'} className="flex items-center" aria-label="Flotter">
            <svg width="34" height="34" viewBox="0 0 104 104" fill="none" xmlns="http://www.w3.org/2000/svg" role="img">
              <defs>
                <linearGradient id="paint0_linear_15_32" x1="52" y1="0" x2="52" y2="104" gradientUnits="userSpaceOnUse">
                  <stop offset="0" stopColor="#3FA9F5" />
                  <stop offset="1" stopColor="#007ACC" />
                </linearGradient>
              </defs>

              {/* Rounded-square background instead of circle */}
              <rect x="0" y="0" width="104" height="104" rx="18" fill="url(#paint0_linear_15_32)" />

              <path d="M81.5505 49.1111C81.5505 43.7678 79.688 36.7327 75.4033 31.117C71.2328 25.651 64.7039 21.4211 54.888 21.4211C48.0417 21.4211 43.1683 23.001 39.8134 25.6772C36.5093 28.3128 34.1893 32.4018 33.1591 38.4723C32.9377 39.7775 32.1345 40.8988 30.9912 41.499C27.6761 43.2393 25.0129 44.6821 22.986 45.8334C23.6483 46.4013 24.318 47.0968 24.8636 47.936C26.0816 49.8095 26.5721 52.252 25.5771 54.8598C25.0554 56.2271 24.3046 57.8039 23.6523 59.2103C22.9608 60.7013 22.312 62.1389 21.8132 63.5209C21.3067 64.9246 21.0401 66.0458 20.9898 66.8959C20.9418 67.7066 21.1031 67.976 21.1552 68.0512C21.2459 68.182 21.463 68.4269 22.24 68.691C23.0966 68.9821 24.1906 69.1561 25.794 69.3737C28.5917 69.7534 33.1829 70.2107 36.8206 73.1942L37.0201 73.3599C41.1897 76.8629 44.0812 81.9324 45.9274 88.154C46.5872 90.3772 45.3778 92.7322 43.2263 93.4139C41.0747 94.0956 38.7957 92.846 38.136 90.6227C36.6134 85.4919 34.4494 82.0531 31.8768 79.892L31.754 79.79C30.2138 78.5268 28.1027 78.1804 24.7327 77.723C23.2523 77.5221 21.3961 77.2691 19.6937 76.6905C17.9117 76.0848 15.9607 75.0171 14.532 72.9577C13.0646 70.8425 12.7325 68.4621 12.8555 66.3822C12.9762 64.3414 13.5451 62.3304 14.1773 60.5785C14.8174 58.805 15.6108 57.0637 16.3033 55.5706C16.909 54.2649 17.4071 53.2092 17.7793 52.3119C17.5746 52.1376 17.3061 51.9418 16.9632 51.7209C16.6005 51.4873 16.2163 51.264 15.7831 51.0153C15.3953 50.7925 14.8806 50.5006 14.4405 50.2149C14.1009 49.9945 13.2922 49.4647 12.6722 48.6375C12.3286 48.179 11.8187 47.3374 11.7176 46.1633C11.6052 44.8584 12.0453 43.7344 12.6511 42.9356C13.2889 42.0946 14.2502 41.4209 14.8238 41.0286C15.5744 40.5153 16.5386 39.9185 17.6816 39.2486C19.6388 38.1014 22.2655 36.6558 25.5434 34.9179C27.0297 28.26 30.0504 22.8267 34.8335 19.0112C40.0594 14.8426 46.8958 13 54.888 13C67.3297 13 76.1694 18.5195 81.8031 25.9033C87.3226 33.1374 89.7 42.0527 89.7 49.1111C89.7 62.5753 79.6282 76.3707 65.1768 80.9473C65.9663 82.3292 67.3257 84.1874 69.408 86.5595C70.9199 88.2818 70.7944 90.9447 69.1275 92.507C67.4607 94.0694 64.8837 93.9396 63.3718 92.2172C60.7478 89.2281 58.7149 86.4784 57.524 84.0302C56.4619 81.8468 55.3601 78.3984 57.3717 75.3712L57.4297 75.2862C58.0381 74.4172 58.9458 73.8198 59.9679 73.6185C72.8267 71.0859 81.5505 59.334 81.5505 49.1111Z" fill="#082032" />

              <path d="M58.0964 55.0929C59.8181 54.1388 62.0798 54.6118 63.1481 56.1495C64.2164 57.6872 63.6867 59.7072 61.9651 60.6613C61.1513 61.1123 60.17 61.7229 59.2888 62.3585C58.3539 63.0327 57.755 63.576 57.5096 63.8817C56.8042 64.7607 56.1351 65.5502 55.5458 66.2453C54.9438 66.9553 54.4459 67.543 54.0198 68.085C53.1342 69.2112 52.8501 69.7921 52.7677 70.1619C52.3724 71.9368 50.441 73.0895 48.4537 72.7364C46.4665 72.3834 45.1759 70.6584 45.5712 68.8835C45.9671 67.1058 47.0148 65.5908 48.0152 64.3185C48.532 63.6613 49.1157 62.9739 49.6963 62.2892C50.2895 61.5895 50.904 60.8641 51.5459 60.0642C52.3784 59.027 53.5986 58.0391 54.6791 57.2598C55.8136 56.4416 57.0448 55.6757 58.0964 55.0929Z" fill="#082032" />

              <path fillRule="evenodd" clipRule="evenodd" d="M45.5353 37.7834C44.6092 41.4293 44.8848 43.9896 46.362 45.4638C47.8394 46.9382 50.3573 47.9022 53.9157 48.3561C53.1083 53.0588 54.0927 55.265 56.8686 54.9747C59.6446 54.6843 61.3124 53.5137 61.8724 51.4628C66.2108 52.7002 68.5621 51.6647 68.9263 48.3561C69.4728 43.3932 66.8357 39.4342 65.7546 39.4342C64.6734 39.4342 61.8724 39.3007 61.8724 37.7834C61.8724 36.2658 58.6005 35.4085 55.6476 35.4085C52.6947 35.4085 54.4718 33.3885 50.4169 34.1866C47.7137 34.7187 46.0864 35.9175 45.5353 37.7834Z" fill="#FFCC00" />

              <path d="M47.3989 29.2772C48.7907 29.0168 50.0583 28.9062 51.2084 29.0937C52.5778 29.317 53.4728 29.9077 54.0959 30.4637C54.1693 30.5292 54.23 30.5839 54.28 30.6291C54.3236 30.6308 54.3745 30.6319 54.4334 30.6319C56.5042 30.6319 58.7893 30.9109 60.6764 31.5213C61.6045 31.8216 62.6522 32.2702 63.5342 32.9681C64.1496 33.4551 64.8364 34.1968 65.2063 35.1939C65.3732 35.2193 65.5576 35.2407 65.755 35.2571C66.1333 35.2885 66.4899 35.2965 66.7541 35.2965C67.8924 35.2965 68.7663 35.7585 69.2418 36.0639C69.7753 36.4067 70.2279 36.8255 70.5978 37.2293C71.3441 38.0439 72.0213 39.0904 72.5741 40.2554C73.6851 42.5972 74.4668 45.7871 74.0554 49.3383C73.7404 52.058 72.4081 54.5899 69.5137 55.8016C67.7866 56.5246 65.8466 56.615 63.8733 56.3525C63.3428 57.0189 62.701 57.6088 61.9507 58.1094C60.3093 59.2043 58.3396 59.7481 56.2761 59.9533C54.9839 60.0817 53.5676 59.968 52.2426 59.3263C50.8681 58.6606 49.9155 57.583 49.3354 56.3471C48.6953 54.9834 48.4886 53.3922 48.5406 51.7138C45.3686 51.0112 42.6441 49.8467 40.6909 47.9939C37.485 44.9531 37.5667 40.348 38.7594 35.8853C38.7706 35.8433 38.7827 35.8016 38.7955 35.7601C39.9878 31.9239 43.46 30.014 47.3989 29.2772ZM49.7422 35.6779C49.5298 35.6938 49.1993 35.7325 48.7152 35.8231C46.1511 36.3027 45.6035 37.1304 45.4331 37.6254C44.4299 41.4294 45.0988 42.7813 45.4992 43.2015L45.5374 43.2395C46.5271 44.1783 48.6742 45.1656 52.7531 45.6601C53.6909 45.7738 54.5394 46.253 55.1013 46.986C55.6632 47.7191 55.8893 48.6422 55.7271 49.5403C55.5066 50.7608 55.4294 51.7113 55.4486 52.4258C55.4598 52.842 55.5027 53.1316 55.5462 53.3222C55.5532 53.3216 55.5603 53.3212 55.5675 53.3205C56.8879 53.1892 57.6269 52.8866 58.0187 52.6252C58.3454 52.4073 58.5576 52.1412 58.6908 51.6775C58.9362 50.8233 59.5241 50.0986 60.3245 49.6634C61.125 49.2282 62.0722 49.1184 62.9568 49.3582C65.3565 50.0087 66.4347 49.8217 66.7618 49.6848C66.8513 49.6473 66.876 49.6224 66.9148 49.5635C66.9769 49.469 67.1163 49.1955 67.1855 48.598C67.4403 46.3988 66.9477 44.4198 66.2885 43.0303C66.0628 42.5546 65.8372 42.1899 65.6512 41.9343C64.8894 41.8918 63.9352 41.7913 63.0142 41.5576C62.294 41.3748 61.3003 41.0406 60.4224 40.3661C59.6966 39.8085 59.0302 38.9896 58.7312 37.9315C58.658 37.9038 58.5741 37.8742 58.4785 37.8433C57.4713 37.5175 55.9623 37.2998 54.4334 37.2998C53.1457 37.2998 51.9751 37.0896 50.9278 36.5251C50.4238 36.2535 50.0522 35.9547 49.7926 35.7234C49.7754 35.7082 49.7587 35.6929 49.7422 35.6779Z" fill="#082032" />

            </svg>
          </Link>
        </div>

        {/* Right: Action Buttons (Support, Settings) per JSON "elements" */}
        <div className="flex items-center gap-3">
          {!isLoading && (
            <>
              {user ? (
                <>
                  {/* Action Button: Word Library */}
                  <Link
                    href="/cards/library"
                    className={`p-2 hover:text-[#3B82F6] transition-colors ${isDark ? 'text-[#9CA3AF]' : 'text-[#6B7280]'}`}
                    title="Word Library"
                  >
                    <BookOpen size={19} />
                  </Link>

                  {/* Action Button: Ranking */}
                  <Link
                    href="/ranking"
                    className={`p-2 hover:text-[#3B82F6] transition-colors ${isDark ? 'text-[#9CA3AF]' : 'text-[#6B7280]'}`}
                    title="Rankings"
                  >
                    <Trophy size={19} />
                  </Link>

                  {/* Action Button: Settings */}
                  <Link
                    href="/settings"
                    className={`p-2 hover:text-[#3B82F6] transition-colors ${isDark ? 'text-[#9CA3AF]' : 'text-[#6B7280]'}`}
                    title="Settings"
                  >
                    <Settings size={19} />
                  </Link>

                  {/* Profile: item_radius 12px instead of full circle to match system */}
                  <Link
                    href="/profile"
                    className={`ml-2 flex items-center justify-center w-[36px] h-[36px] rounded-[12px] border text-[#9CA3AF] hover:border-[#3B82F6] transition-all overflow-hidden ${isDark ? 'bg-[#222222] border-[#2D2D2F]' : 'bg-[#F0F1F3] border-[#E2E4E9]'}`}
                  >
                    {user.image ? (
                      <img src={user.image} alt="Profile" className="w-full h-full object-cover" />
                    ) : (
                      <User size={18} />
                    )}
                  </Link>
                </>
              ) : (
                <div className="flex items-center gap-2">
                  <LanguageSwitcher />

                  <Link
                    href="/login"
                    // body_large: 15px SemiBold
                    className={`text-[15px] font-semibold transition-colors px-3 ${isDark ? 'text-[#9CA3AF] hover:text-[#FFFFFF]' : 'text-[#6B7280] hover:text-[#111827]'}`}
                  >
                    {t('header.login')}
                  </Link>

                  <Link
                    href="/register"
                    // button_primary: bg #3B82F6, radius 12px, text white
                    className="text-[14px] font-bold uppercase tracking-widest bg-[#3B82F6] text-[#FFFFFF] px-[20px] py-[10px] rounded-[12px] hover:bg-[#1D4ED8] transition-all active:scale-95"
                  >
                    {t('header.join')}
                  </Link>
                </div>
              )}
            </>
          )}
        </div>
      </nav>
    </header>
  )
}